<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta http-equiv="X-UA-Compatible" content="ie=edge" />
		<title>Identicon Generator</title>
		<style>
			#scratchpad {
				width: 64px;
				height: 64px;
				border: 1px solid black;
			}
		</style>
	</head>
	<body>
		<form>
			<label
				><span>Type your name here:</span
				><input
					type="text"
					name="sourceString"
					placeholder="Joe Schmoe"
					required
					minlength="1"
					autofocus
			/></label>
			<button type="submit">Generate My Identicon!</button>
		</form>
		<canvas id="scratchpad" hidden></canvas>
		<a href="" id="resultDownloadLink" download=""
			><img src="" id="resultImg"
		/><br /><span>Download Your Identicon!</span></span></a>
		<script>
			/*
							TODO:
							 - differentiate icons via -
							 	- serif vs sanserif
								- dark-on-light vs light-on-dark
								- foreground and background colours
								- stroke vs no stroke?
								- background shapes?
								- border?
						*/
			function generateIdenticon(sourceString, defaultLetter = "x") {
				const firstLetter =
					sourceString.match(/[a-zA-Z0-9]/)?.[0] ?? defaultLetter;
				context.font = "128px serif";
				context.fillText(firstLetter, 100, 100);
				const resultDataURL = canvas.toDataURL("image/png");
				//	beautiful
				resultImg.src = resultDataURL;
				resultDownloadLink.href = resultDataURL;
				resultDownloadLink.download = sourceString;
			}

			const searchParams = new URLSearchParams(window.location.search);
			const sourceString = searchParams.get("sourceString");
			const canvas = document.querySelector("#scratchpad");
			const context = canvas.getContext("2d");
			const resultDownloadLink = document.querySelector("#resultDownloadLink");
			const resultImg = document.querySelector("#resultImg");

			if (sourceString) {
				//	default the input field to the previously submitted text for continuity's sake
				document.querySelector("[name=sourceString]").value = sourceString;
				//	and make the thing
				generateIdenticon(sourceString);
			}
		</script>
	</body>
</html>
